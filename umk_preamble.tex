\documentclass {scrartcl} % [fontsize=14pt] 

\usepackage {cmap}
\usepackage [T2A] {fontenc}
\usepackage [utf8] {inputenc}
\usepackage [english, russian] {babel}
\usepackage{pbox}      % боксы на титульных страницах
\usepackage{lipsum}	   % Рыба

% Отступы
\usepackage{setspace}      % Межстрочный интервал
%\onehalfspacing
\usepackage{indentfirst}
\frenchspacing
\parindent=1.25cm


% Поля
\usepackage %
[ %
  left = 2.5cm,
  right = 1.5cm,
  top = 2cm,
  bottom = 1.27cm,
  includefoot,
  footskip = 1cm
] %
  {geometry}

% Шрифт
%\usepackage{paratype}
%\usepackage{libertine}
\usepackage{droid}        % имеется капитель и даже полужирная капитель
\usepackage{textcase}    % Преобразование к верхнему регистру

% Бланки
\newcommand{\uline}[1]{\underline{\makebox[#1]{}}}
\newcommand{\ugap}{\uline{.5cm}}
\newcommand{\ulinepad}[1]{%
\underline{\makebox[.3cm]{\vphantom{#1}}}%
\underline{#1}%
\underline{\makebox[.3cm]{\vphantom{#1}}}%
}

% Вид заголовков
\renewcommand{\thesection}{\Roman{section}}    % римские номера для разделов

% вид заголовка раздела:
% \KOMAoption{headings}{normal} % уменьшить кегль
\addtokomafont{section}{\scshape\centering} 

% вид заголовка подраздела:
%% серия грязных хаков. Идея в реализации подраздела через параграфы.
\setcounter{secnumdepth}{5} 
% \setcounter{tocdepth}{5} % если нужно видеть подразделы в Содержании
\newcounter{ssectCounter}[section]
\renewcommand{\theparagraph}{\arabic{section}.\arabic{ssectCounter}}
\usepackage{etoolbox}
% команда для подраздела: \ssect или \ssect[Заголовок]
\newcommand{\ssect}[1][]{%
	\stepcounter{ssectCounter}
	\ifstrempty{#1}{%
		\setkomafont{paragraph}{\normalfont} 
		\paragraph{}
	}{%
		\setkomafont{paragraph}{\normalfont\bfseries}
		\paragraph{#1} 
	}%
}
% теперь параграф это практически подраздел и с точки зрения toc
\makeatletter
\renewcommand*\l@paragraph{\bprot@dottedtocline{2}{1.8em}{2.2em}}
\makeatother

% Макросы титульной страницы
\renewcommand \date [1] %
{ %
  \newcommand \thedate {#1} %
} %

\newcommand \course [1] %
{ %
  \newcommand \thecourse {<<#1>>} %
} %

\newcommand \direction [1] %
{ %
  \newcommand \thedirection {#1} %
} %

\newcommand \degree [1] %
{ %
  \newcommand \thedegree {#1} %
} %

\newcommand \bychair [1] %
{ %
  \newcommand \thebychair {#1} %
} %

\newcommand \yearofstudy [1] %
{ %
  \newcommand \theyearofstudy {#1} %
} %

\newcommand \term [1] %
{ %
  \newcommand \theterm {#1} %
} %

\newcommand \form [1] %
{ %
  \newcommand \theform {#1} %
} %

\newcommand \createdby [1] %
{ %
  \newcommand \thecreatedby {#1} %
} %

\newcommand {\vgap} {\vspace{1.2\baselineskip}} %

% титульная страница РПД
\AtBeginDocument %
{ %
  \thispagestyle {empty}\large
  %  
  \begin{spacing}{1.1}
  \begin {center}
    %
    \textsc{Минобрнауки России}

    \vgap
    Федеральное государственное автономное образовательное
    учреждение высшего профессионального образования

    \textsc{Южный федеральный университет}

    \vgap
    Институт математики, механики и компьютерных наук
    %
  \end {center}
  %
    \vgap
	\hfill 
	\begin{minipage}{0.45\textwidth}
	\begin{center}
	Утверждаю

	Директор института

	\vspace{2\baselineskip}
	\hfill М.\,И.~Карякин
	\hrule

	\vspace{.5\baselineskip}
	<<1>> августа 2014\,г. 
	\end{center}
	\end{minipage}
    
  \vgap
  \begin {center}
    {\LARGE\bfseries
    \textsc{Рабочая программа дисциплины}
    
    \thecourse\par
    }

    \vgap
    Направление подготовки\\
    \thedirection

    \vgap
    Профиль подготовки: \uline{5cm}

    \vgap
    Квалификация (степень) выпускника\\
    \ulinepad{\thedegree}

    \vgap
    Кафедра \ulinepad{\thebychair}

    \vgap
    Курс \ulinepad{\theyearofstudy} $\quad$ семестр \ulinepad{\theterm}

    \vgap
    Форма обучения \ulinepad{\theform}

    \vgap
    Программа разработана \hfill
    %
	\begin{minipage}[t]{.65\textwidth}
	\begin{flushleft}
	\thecreatedby
	\end{flushleft}
	\end{minipage}

	\vgap
	\begin{flushleft}
	Рецензент(ы)
	\end{flushleft}
	\uline{.8\textwidth}
  \end {center}
  %
  \vspace {\fill}
  %
  \begin {center}
    %
    Ростов-на-Дону~--- \thedate
    %
  \end {center}
  %
  \end{spacing}
  \clearpage\normalsize
} %

% ----------------------------------------------------------------
% Настройка переносов и разрывов страниц

\binoppenalty = 10000      % Запрет переносов строк в формулах
\relpenalty = 10000        %

\sloppy                    % Не выходить за границы бокса
%\tolerance = 400          % или более точно
\clubpenalty = 10000       % Запрет разрывов страниц после первой
\widowpenalty = 10000      % и перед предпоследней строкой абзаца

% ----------------------------------------------------------------

% Настройка списков
\usepackage {enumitem}
% нумерация кириллическими буквами
\makeatletter
    \AddEnumerateCounter{\asbuk}{\@asbuk}{м)}
\makeatother
\renewcommand{\labelenumi}{\asbuk{enumi})}

% Таблицы
\usepackage{longtable}
%\usepackage{float}
%\restylefloat{longtable}

% Команда для описания модуля (myunit)
% Вначале создаём новый тип перечня на базе description
%   с горизонтальными линиями после пунктов
%   http://tex.stackexchange.com/q/44205/7460 много кода :(

\usepackage{framed}
\usepackage{letltxmacro}
\usepackage{xstring}

\newtoggle{IsFirstItem}  % so we don't add rule above first item
\toggletrue{IsFirstItem} % personal preference: initialize variables
						 %           explicetly at time of defintion

\newcommand*{\WernersHRule}{ % 
   \par\kern\dimexpr.7\itemsep-\parskip-.3\baselineskip\relax%
   \hrulefill%\rule{\textwidth}{.4mm}%
   \par\kern\dimexpr.3\itemsep-.3\parskip-.3\baselineskip\relax%
}%

\LetLtxMacro{\OriginalItem}{\item}         % store existing definition of \item
\newcommand{\ItemWithRuleAbove}[1][]{%
    \iftoggle{IsFirstItem}{}{\WernersHRule}% only add \hrule if not first item
    \IfStrEq{#1}{}{\OriginalItem }{\OriginalItem [#1]}%
    \togglefalse{IsFirstItem}%
}%

% наконец, сам новый тип перечня на базе description:
\newenvironment{MyUnitDescription}{%
    \toggletrue{IsFirstItem}%
    \let\item\ItemWithRuleAbove%
    \begin{description}[topsep=0pt]%
}{%
    \end{description}%
}%

% Увеличенная толщина рамки для информации о модуле
\setlength{\FrameRule}{.6mm}

% Счётчик модулей
\newcounter{myunitCounter}
\newcommand{\themyunit}{\arabic{myunitCounter}}

% Сохраняем имена модулей для использования в следующем пункте
\usepackage{pgfkeys}
\newcommand{\setvalue}[1]{\pgfkeys{/variables/#1}}
\newcommand{\getvalue}[1]{\pgfkeysvalueof{/variables/#1}}
\newcommand{\declare}[1]{%
 \pgfkeys{
  /variables/#1.is family,
  /variables/#1.unknown/.style = {\pgfkeyscurrentpath/\pgfkeyscurrentname/.initial = ##1}
 }%
}

% пространство имён переменных для имён модулей
\declare{UnitNames/}

% Макрос описания одного модуля
\newcommand{\myunit}[3]{%
	\stepcounter{myunitCounter}
	\IfEq{\themyunit}{1}{\mbox{}
	 % маленький хак, чтобы описание первого модуля не всплыло выше заголовка
	}{}
	\setvalue{UnitNames/\themyunit = #1} % сохранили название
	\begin{framed}
	\begin{MyUnitDescription}
		\item [Номер модуля:] \themyunit
		\item [Название модуля:]	#1
		\item [Содержание модуля] #2
		\item [Формы текущего контроля] #3
	\end{MyUnitDescription}
	\end{framed} 
}

% Команды для описания расчасовки в модуле (myunithours, printhours)

\usepackage{calc}
\usepackage{array}
\usepackage{tabu}

% величины, вычисляемые относительно заданных часов лек./практ./лаб.
\newcounter{distantUnitHours} % = лек. + практ. + лаб.
\newcounter{wholeUnitHours}   % = 2 * distantUnitHours

% счётчик модулей
\newcounter{myunitIdx}
\setcounter{myunitIdx}{0}
 
% величины для последней строки таблицы (Итого)
\newcounter{wholeHours}
\newcounter{lectureHours}
\newcounter{seminarHours}
\newcounter{labHours}
\newcounter{distantHours}

\setcounter{wholeHours}{0}
\setcounter{lectureHours}{0}
\setcounter{seminarHours}{0}
\setcounter{labHours}{0}
\setcounter{distantHours}{0}

% если получилось 0 часов, то не пишем (для последней строки -- Итого)
\newcommand{\ifZeroErase}[1]{%
	\IfEq{#1}{0}{}{#1}
}

% будем запоминать значения часов по каждому модулю, потому что
% вначале нужно сгенерировать таблицу с суммами, а потом -- с часами

% пространства имён для часов по каждому модулю
\declare{UnitLectureHours/}
\declare{UnitSeminarHours/}
\declare{UnitLabHours/}

\newcommand{\myunithours}[3]{%

	% вычисляем рассчитываемые часы (всего и дистантные)
	\setcounter{distantUnitHours}{#1 + #2 + #3}%
	\setcounter{wholeUnitHours}{\value{distantUnitHours} * 2}%
%
	% пересчитываем общие суммы
	\addtocounter{wholeHours}{\value{wholeUnitHours}}%
	\addtocounter{lectureHours}{#1}%
	\addtocounter{seminarHours}{#2 + 0}%
	\addtocounter{labHours}{#3 + 0}%
	\addtocounter{distantHours}{\value{distantUnitHours}}%
%
	% запоминаем значения часов для текущего модуля
	\stepcounter{myunitIdx}
	\setvalue{UnitLectureHours/\arabic{myunitIdx} = #1}
	\setvalue{UnitSeminarHours/\arabic{myunitIdx} = #2}
	\setvalue{UnitLabHours/\arabic{myunitIdx} = #3}
}

\usepackage{forloop}

\newcommand{\printhours}[2]{

	% Первая таблица с суммами
	%	оформление:
	\renewcommand{\arraystretch}{1.5}
	\setlength\LTleft{0pt}
	\setlength\LTright{0pt}

	\tabulinesep = 1mm
	\begin{longtabu} to \textwidth {|X[4,p] | X[1,c,p]|} \hline
	\textsc{Вид работы} & \textsc{%
		\begin{tabular}{cc}
			Трудоемкость\\(часов)
		\end{tabular}
	} 															\\ \hline
	\textbf{Общая трудоемкость} 	& \arabic{wholeHours} 		\\ \hline
	\textbf{Аудиторная работа:}		& \arabic{distantHours} 	\\ \hline % всегда равна самостоятельной, поэтому отдельно не считали
	\hspace{1.25cm}Лекции (Л) 		& \arabic{lectureHours} 	\\ \hline
	\hspace{1.25cm}Практические занятия (ПЗ)
									& \arabic{seminarHours} 	\\ \hline
	\hspace{1.25cm}Лабораторные работы (ЛР)
									& \arabic{labHours} 		\\ \hline
	\textbf{Самостоятельная работа:}& 							\\ \hline
	\hspace{1.25cm}Самоподготовка (проработка и повторение лекционного материала и материала учебников и учебных пособий, подготовка к лабораторным и практическим занятиям, коллоквиумам, рубежному контролю и т.д.)%
									& \arabic{distantHours} 	\\ \hline
	Вид итогового контроля (зачет, экзамен)% 
									& #2 						\\ \hline
	\end{longtabu}

	% Вторая таблица с подробной расчасовкой
	\begin{longtabu} to .98\textwidth {|c|X[p]|c|c|c|c|c|} % .98  это грязный хак: не знаю, почему она выходит шире, чем нужно без него
		\caption*{\textsc{Модули дисциплины, изучаемые в #1 семестре}} \\

		\hline
		& 
		& \multicolumn{5}{c|}{\bfseries Количество часов} \\ \cline{3-7}
		%
	\bfseries
	\begin{tabular}{c}
		№ \\ модуля 
	\end{tabular}
		& \centering\bfseries Наименование модулей
	    & \bfseries Всего
	    & \multicolumn{3}{c|}{\bfseries%
		    \begin{tabular}{c}
			Аудиторная \\ работа 
			\end{tabular}}
	    & \bfseries
	    	\begin{tabular}{c}
			Внеауд. \\ работа \\ СР
			\end{tabular} \\ \cline{4-6}
			%
	&
		&
		& \bfseries Л
		& \bfseries ПЗ
		& \bfseries ЛР
		& 
		\\ \hline
	%
	% Цикл генерации строк таблицы с часами для каждого модуля
	\stepcounter{myunitCounter}
	\forloop{myunitIdx}{1}{\value{myunitIdx} < \value{myunitCounter}} {%
		\setcounter{distantUnitHours}{%
			\getvalue{UnitLectureHours/\arabic{myunitIdx}}
			+ \getvalue{UnitSeminarHours/\arabic{myunitIdx}}
			+ \getvalue{UnitLabHours/\arabic{myunitIdx}}}%
		\setcounter{wholeUnitHours}{\value{distantUnitHours} * 2}%
		\IfEq{\arabic{myunitIdx}}{1}{\hspace{-1mm}}{}
		\arabic{myunitIdx} 
			& \getvalue{UnitNames/\arabic{myunitIdx}}
			& \arabic{wholeUnitHours}
			& \getvalue{UnitLectureHours/\arabic{myunitIdx}}
			& \getvalue{UnitSeminarHours/\arabic{myunitIdx}}
			& \getvalue{UnitLabHours/\arabic{myunitIdx}}
			& \arabic{distantUnitHours}
			\\ \hline
	}
	&	Итого:
		& \arabic{wholeHours}
		& \ifZeroErase{\arabic{lectureHours}}
		& \ifZeroErase{\arabic{seminarHours}}
		& \ifZeroErase{\arabic{labHours}}
		& \arabic{distantHours} 
		\\ \hline
	\end{longtabu}
}

% Печать информации о лабораторных (при необходимости)

\declare{LabNames/}
\declare{LabUnit/}
\declare{LabHours/}

\newcounter{mylabCounter}
\setcounter{mylabCounter}{0}

\newcounter{mylabUnitCounter}
\setcounter{mylabUnitCounter}{1}

\newcommand{\incMyunit}[1][1]{%
	\addtocounter{mylabUnitCounter}{#1}
}

\newcommand{\mylab}[2]{%
	\stepcounter{mylabCounter}

	\IfEq{\arabic{mylabCounter}}{1}{}{\hspace{-.1cm}}%
	\arabic{mylabCounter}
	& \arabic{mylabUnitCounter}
	& #1
	& #2
		\\ \hline%
}

\newcommand{\printlabs}[1]{%
\begin{longtabu} to \textwidth {|c|c|X[p]|c|}
	\hline
	\bfseries
	\begin{tabular}{c}
		№ \\ ЛР 
	\end{tabular}
		&
		\bfseries
		\begin{tabular}{c}
			№ \\ модуля 
		\end{tabular}
		&
		\centering\bfseries Наименование лабораторных работ
		&
		\bfseries
		\begin{tabular}{c}
			Кол-во \\ часов
		\end{tabular}
		\\ \hline
	#1
\end{longtabu}
}


\endinput